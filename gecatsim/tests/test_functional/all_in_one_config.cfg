# Phantom
phantom.callback = "Phantom_Analytic"      # name of function that reads and models phantom
phantom.projectorCallback = "C_Projector_Analytic" # name of function that performs projection through phantom
phantom.filename = 'W20.ppm'       # phantom filename
phantom.centerOffset = [0, 0.0, 0.0]      # offset of phantom center relative to origin (in mm)
#phantom.scale = 10.0                         # re-scale the size of phantom
#phantom.projectorNumThreads = 16

# Geometric and energy sampling
physics.energyCount = 24
physics.monochromatic = -1
physics.colSampleCount = 1
physics.rowSampleCount = 1
physics.srcXSampleCount = 1
physics.srcYSampleCount = 1
physics.viewSampleCount = 1
physics.recalcDet = 0
physics.recalcSrc = 0
physics.recalcRayAngle = 0
physics.recalcSpec = 0
physics.recalcFilt = 0
physics.recalcFlux = 0
physics.recalcPht = 0
physics.recalcDet = 0
physics.enableQuantumNoise = 1
physics.enableElectronicNoise = 1
physics.rayAngleCallback = "Detector_RayAngles_2D"
physics.fluxCallback = "Detection_Flux"
physics.scatterCallback = ""
physics.prefilterCallback = "Detection_prefilter"
physics.crosstalkCallback = "CalcCrossTalk"
physics.col_crosstalk = 0.025
physics.row_crosstalk = 0.02
physics.lagCallback = "Detection_Lag"
physics.lag_taus = [0.9, 6]
physics.lag_alphas = [0.93, 0.07]
physics.opticalCrosstalkCallback = "CalcOptCrossTalk"
physics.col_crosstalk_opt = 0.04
physics.row_crosstalk_opt = 0.045
physics.DASCallback = "Detection_DAS"
physics.outputCallback = "WriteRawView"
protocol.scanTypes = [1, 1, 1]              # flags for airscan, offset scan, phantom scan
physics.callback_post_log = 'Prep_BHC_Accurate'
physics.EffectiveMu = 0.2
physics.BHC_poly_order = 5
physics.BHC_max_length_mm = 300
physics.BHC_length_step_mm = 10

# Table and gantry
protocol.scanTrajectory = "Gantry_Helical"  # name of the function that defines the scanning trajectory and model
protocol.viewsPerRotation = 984          # total numbers of view per rotation
protocol.viewCount = 1084                  # total number of views in scan
protocol.startViewId = 0                    # index of the first view in the scan
protocol.stopViewId = protocol.startViewId+protocol.viewCount-1 # index of the last view in the scan
protocol.airViewCount = 1                   # number of views averaged for air scan
protocol.offsetViewCount = 1                # number of views averaged for offset scan
protocol.rotationTime = 1.0                 # gantry rotation period (in seconds)
protocol.rotationDirection = 1              # gantry rotation direction (1=CW, -1 CCW, seen from table foot-end)
protocol.startAngle = -100/984*360                     # relative to vertical y-axis (n degrees)
protocol.tableSpeed = 0                     # speed of table translation along positive z-axis (in mm/sec)
protocol.startZ = 0                         # start z-position of table
protocol.tiltAngle = 0                      # gantry tilt angle towards negative z-axis (in degrees)
protocol.wobbleDistance = 0.0               # focalspot wobble distance
protocol.focalspotOffset = [0, 0, 0]        # focalspot position offset
protocol.mA = 130                           # tube current (in mA)
protocol.spectrumCallback = "Spectrum"      # name of function that reads and models the X-ray spectrum
protocol.spectrumFilename = "xcist_kVp120_tar7_bin1.dat" # name of the spectrum file
protocol.spectrumUnit_mm = 1;               # Is the spectrum file in units of photons/sec/mm^2/<current>?
protocol.spectrumUnit_mA = 1;               # Is the spectrum file in units of photons/sec/<area>/mA?
protocol.spectrumScaling = 1;                # scaling factor, works for both mono- and poly-chromatic spectra
protocol.bowtie = "large.txt"       # name of the bowtie file (or [])
protocol.filterCallback = "Xray_Filter"     # name of function to compute additional filtration
#protocol.flatFilter = []            # additional filtration - materials and thicknesses (in mm)
protocol.flatFilter = ['air', 0.001] 
#protool.flatFilter = ['Al',3.0]            # additional filtration - materials and thicknesses (in mm)
protocol.dutyRatio = 1.0                    # tube ON time fraction (for pulsed tubes)

# Reconstruction
recon.fov = 300.0           # diameter of the reconstruction field-of-view (in mm)
recon.imageSize = 512       # number of columns and rows to be reconstructed (square)
recon.sliceCount = 4        # number of slices to reconstruct
recon.sliceThickness = 0.625  # reconstruction inter-slice interval (in mm)
recon.centerOffset = [0.0, 0.0, 0.0] # reconstruction offset relative to center of rotation (in mm)
recon.reconType = 'fdk_equiAngle'    # Name of the recon function to call
recon.kernelType = 'standard'        # 'R-L' for the Ramachandran-Lakshminarayanan (R-L) filter, rectangular window function
                                     # 'S-L' for the Shepp-Logan (S-L) filter, sinc window function
                                     # 'Soft', 'Standard', 'Bone' for kernels similar to those on clinical scanners
recon.startAngle = 0                 # in degrees; 0 is with the X-ray source at the top
recon.unit = 'HU'                    # '/mm', '/cm', or 'HU'
recon.mu = 0.02                      # in /mm; typically around 0.02/mm
recon.huOffset = -1000               # unit is HU, -1000 HU by definition but sometimes something else is preferable
recon.printReconParameters = False   # Flag to print the recon parameters
recon.displayImagePictures = False    # Flag to display the recon results as .png images
recon.saveImagePictureFiles = False   # Flag to save the recon results as .png images
recon.saveImageVolume = True         # Flag to save recon results as one big file
recon.saveSingleImages = False        # Flag to save recon results as individual images

# Scanner geometry
scanner.detectorCallback = "Detector_ThirdgenCurved" # name of function that defines the detector shape and model
scanner.sid = 541.0                         # source-to-iso distance (in mm)
scanner.sdd = 949.075                         # source-to-detector distance (in mm)
scanner.detectorColsPerMod = 1              # number of detector columns per module
scanner.detectorRowsPerMod = 4             # number of detector rows per module
scanner.detectorColOffset = -1.25             # detector column offset relative to centered position (in detector columns)
scanner.detectorRowOffset = 0.0             # detector row offset relative to centered position (in detector rows)
scanner.detectorColSize = 1.0239               # detector column pitch or size (in mm)
scanner.detectorRowSize = 1.0915               # detector row pitch or size (in mm)
scanner.detectorColCount = 888              # total number of detector columns
scanner.detectorRowCount = scanner.detectorRowsPerMod     # total number of detector rows
#scanner.detectorPrefilter = []  # detector filter
scanner.detectorPrefilter = ['air', 0.001]  # detector filter
scanner.focalspotCallback = "SetFocalspot" # name of function that defines the focal spot shape and model
#scanner.focalspotShape = "performix" # name of function that defines the focal spot shape and model
scanner.focalspotData = "vct_small_fs.npz"          # Parameterize the model
scanner.targetAngle = 7.0                   # target angle relative to scanner XY-plane (in degrees)
scanner.focalspotLength = 0.5647
scanner.focalspotWidth = 0.8974
scanner.focalspotWidthThreshold =0.5
scanner.focalspotLengthThreshold =0.5
scanner.detectorMaterial = "Lumex"          # detector sensor material
scanner.detectorDepth = 5.0                 # detector sensor depth (in mm)
scanner.detectionCallback = "Detection_EI"  # name of function that defines the detection process (conversion from X-rays to detector signal)
scanner.detectionGain = 0.0672                # factor to convert energy to electrons (electrons / keV)
scanner.detectorColFillFraction = 0.7851       # active fraction of each detector cell in the column direction
scanner.detectorRowFillFraction = 0.8094       # active fraction of each detector cell in the row direction
scanner.eNoise = 15.35                    # standard deviation of Gaussian electronic noise (in electrons)
